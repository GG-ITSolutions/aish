# Load user's global xonshrc FIRST if it exists
import os
user_xonshrc = os.path.expanduser('~/.xonshrc')
if os.path.exists(user_xonshrc):
    source @(user_xonshrc)

# Enable output storage for context module
$XONSH_STORE_STDOUT = True
$XONSH_CAPTURE_ALWAYS = True

# Custom project prompt (overrides global)
$PROMPT = '{GREEN}aish{RESET} {BOLD_BLUE}{cwd}{RESET} {RED}@{RESET} '

# Add aish question mark handler
@events.on_transform_command
def aish_question_mark_handler(cmd, **kw):
    if cmd.strip().startswith('?'):
        question = cmd.strip()[1:].strip()
        return f'aish {repr(question)}'
    return cmd

# Add custom keybinding for question mark
@events.on_ptk_create
def custom_keybindings(bindings, **kw):
    @bindings.add('c-space')
    def prefix_with_question_mark(event):
        buffer = event.current_buffer
        current_text = buffer.text
        buffer.text = '? ' + current_text
        buffer.cursor_position = len(buffer.text)
