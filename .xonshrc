# AIsh Development Environment xonsh configuration

# Load user's global xonshrc FIRST if it exists
import os
user_xonshrc = os.path.expanduser('~/.xonshrc')
if os.path.exists(user_xonshrc):
    source @(user_xonshrc)

# NOW override with project-specific settings
# Enable output storage for context module
$XONSH_STORE_STDOUT = True

# WICHTIG: Capture output von ALLEN commands (nicht nur explizit mit $())
$XONSH_CAPTURE_ALWAYS = True

# Custom project prompt (overrides global)
$PROMPT = '{GREEN}aish{RESET} {BOLD_BLUE}{cwd}{RESET} {RED}@{RESET} '

@events.on_transform_command
def aish_question_mark_handler(cmd, **kw):
    if cmd.strip().startswith('?'):
        question = cmd.strip()[1:].strip()
        return f'aish {repr(question)}'
    return cmd

@events.on_ptk_create
def custom_keybindings(bindings, **kw):
    @bindings.add('c-g')
    def prefix_with_question_mark(event):
        buffer = event.current_buffer
        current_text = buffer.text
        buffer.text = '? ' + current_text
        buffer.cursor_position = len(buffer.text)
